<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Environmental Dashboard</title>
  <style>
    /* Global Reset */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body {
      width: 100vw; height: 100vh;
      font-family: 'Roboto', sans-serif;
      background: #f8f8f8;
      overflow: hidden;
    }

    /* hide wrapper */
    .reportview-container {
      margin-top: -2em;
    }
    #MainMenu {visibility: hidden;}
    .stDeployButton {display:none;}
    footer {visibility: hidden;}
    #stDecoration {display:none;}
    /* Main Container */
    #container {
      position: relative;
      width: 100vw;
      height: 100vh;
    }
    /* Map Container */
    #map-container {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      z-index: 10;
    }
    #map-container iframe {
      width: 100%; height: 100%;
      border: none;
    }
    /* Top Pill Container */
    #top-bar-container {
      position: absolute;
      z-index: 120;
    }
    /* Desktop: pills placed to the right of sidebar */
    @media (min-width: 769px) {
      #top-bar-container {
        top: 15px;
        left: calc(360px + 20px);
        right: 20px;
        text-align: center;
      }
      #top-bar {
        display: inline-flex;
        gap: 6px;
        background: rgba(255,255,255,0.95);
        border-radius: 50px;
        padding: 6px 10px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        overflow-x: auto;
        white-space: nowrap;
        justify-content: center;
      }
    }
    /* Mobile: pills centered */
    @media (max-width: 768px) {
      #top-bar-container {
        top: 15px;
        left: 50%;
        transform: translateX(-50%);
        width: 90%;
        text-align: center;
      }
      #top-bar {
        display: flex;
        justify-content: space-around;
        gap: 6px;
        background: rgba(255,255,255,0.95);
        border-radius: 50px;
        padding: 6px 10px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        overflow-x: auto;
        white-space: nowrap;
      }
    }
    #top-bar button {
      background: none;
      border: none;
      padding: 4px 8px;
      cursor: pointer;
      font-size: 14px;
      border-radius: 20px;
      flex: 0 0 auto;
      transition: background 0.2s;
    }
    #top-bar button:hover { background: rgba(0,0,0,0.1); }
    #top-bar button.active { background: #007bff; color: white; }

    /* Desktop Sidebar */
    @media (min-width: 769px) {
      #sidebar {
        position: absolute;
        top: 20px;
        left: 20px;
        width: 360px;
        height: calc(100% - 40px);
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        z-index: 110;
        overflow-y: auto;
        padding: 15px;
      }
      #sidebar.hidden { display: none; }
      #open-sidebar-btn { display: none; }
    }
    /* Mobile Drawer */
    @media (max-width: 768px) {
      #sidebar {
        position: fixed;
        bottom: 0;
        left: 50%;
        transform: translateX(-50%) translateY(70%);
        width: 100%;
        height: 60vh;
        border-radius: 20px 20px 0 0;
        background: #fff;
        box-shadow: 0 -2px 8px rgba(0,0,0,0.2);
        z-index: 110;
        overflow-y: auto;
        padding: 15px;
        transition: transform 0.3s ease-in-out;
      }
      #sidebar.open { transform: translateX(-50%) translateY(0); }
      /* Drawer Handle */
      #drawer-handle {
        width: 50px;
        height: 5px;
        background: #ccc;
        border-radius: 2.5px;
        margin: 8px auto;
        cursor: pointer;
        display: block;
      }
      #open-sidebar-btn { display: none !important; }
    }

    /* Sidebar Toggle Button (Desktop) */
    #open-sidebar-btn {
      position: absolute;
      top: 20px;
      left: 20px;
      z-index: 130;
      background: #fff;
      border: none;
      border-radius: 50%;
      padding: 10px;
      font-size: 18px;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }

    /* Card Styles */
    .card {
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 12px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      width: 100%;
      cursor: pointer;
    }
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .card-title {
      font-size: 16px;
      font-weight: bold;
      color: #333;
    }
    .expand-btn {
      cursor: pointer;
      font-size: 18px;
      color: #007bff;
      border: none;
      background: none;
    }
    .expandable {
      display: none;
      margin-top: 10px;
    }
    .expandable a {
      color: #007bff;
      text-decoration: none;
    }
    .expandable a:hover {
      text-decoration: underline;
    }
    .card-data {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-top: 8px;
    }
    .indicator {
      width: 14px;
      height: 14px;
      border-radius: 50%;
      margin-right: 8px;
      display: inline-block;
    }
    .low { background: #4CAF50; }
    .moderate { background: #FFC107; }
    .high { background: #FF5722; }
    .trend-up {
      color: #4CAF50;
      font-size: 16px;
      font-weight: bold;
    }
    .trend-down {
      color: #FF5722;
      font-size: 16px;
      font-weight: bold;
    }

    /* Time Widget Styles (inside expandable area) */
    .time-widget {
      margin-top: 8px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .time-widget .time-title {
      font-size: 14px;
      color: #333;
    }
    .time-widget input[type=range] {
      flex: 1;
    }
    .time-widget button {
      background: #007bff;
      color: #fff;
      border: none;
      border-radius: 4px;
      padding: 2px 6px;
      font-size: 12px;
      cursor: pointer;
    }

    /* Text Card Styles */
    .text-card {
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 12px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      width: 100%;
    }
    .text-card h3 {
      font-size: 16px;
      font-weight: bold;
      color: #333;
      margin-bottom: 6px;
    }
    .text-card p {
      font-size: 14px;
      color: #555;
      line-height: 1.5;
    }
  </style>
  <script>
    // Toggle Sidebar Function
    function toggleSidebar() {
      var sidebar = document.getElementById("sidebar");
      var openBtn = document.getElementById("open-sidebar-btn");
      if (window.innerWidth > 768) {
        if (window.getComputedStyle(sidebar).display !== "none") {
          sidebar.style.display = "none";
          openBtn.style.display = "block";
        } else {
          sidebar.style.display = "block";
          openBtn.style.display = "none";
        }
      } else {
        sidebar.classList.toggle("open");
      }
    }

    // Toggle Expand Function for Cards
    function toggleExpand(id) {
      var section = document.getElementById(id);
      if (window.getComputedStyle(section).display === "none") {
        section.style.display = "block";
      } else {
        section.style.display = "none";
      }
    }

    // Toggle Layer Function for Top Pills
    function toggleLayer(button, layer) {
      button.classList.toggle("active");
      console.log("Toggled layer:", layer);
    }

    // When a card is clicked, select the corresponding pill
    function selectCard(layer) {
      var buttons = document.querySelectorAll("#top-bar button");
      buttons.forEach(function(btn) {
        btn.classList.remove("active");
        if (btn.textContent.trim().toLowerCase() === layer.toLowerCase()) {
          btn.classList.add("active");
        }
      });
      console.log("Selected card for layer:", layer);
    }

    // Dummy play function for time widget
    function playTime(layer, sliderElem) {
      console.log("Playing time for " + layer + ", current value: " + sliderElem.value);
      // Implement map updates based on time here.
    }

    // Initialization on page load
    document.addEventListener("DOMContentLoaded", function() {
      if (window.innerWidth > 768) {
        document.getElementById("sidebar").style.display = "block";
        document.getElementById("open-sidebar-btn").style.display = "none";
        document.getElementById("drawer-handle").style.display = "none";
      } else {
        document.getElementById("sidebar").classList.remove("open");
        document.getElementById("drawer-handle").style.display = "block";
      }
    });

    window.addEventListener("resize", function() {
      if (window.innerWidth > 768) {
        document.getElementById("sidebar").style.display = "block";
        document.getElementById("sidebar").classList.remove("open");
        document.getElementById("open-sidebar-btn").style.display = "none";
        document.getElementById("drawer-handle").style.display = "none";
      } else {
        document.getElementById("sidebar").style.display = "block";
        document.getElementById("sidebar").classList.remove("hidden");
        document.getElementById("open-sidebar-btn").style.display = "none";
        document.getElementById("drawer-handle").style.display = "block";
      }
    });
  </script>
  <script type="module">
    import {createMap} from 'https://cdn.jsdelivr.net/npm/@foursquare/map-sdk@latest/dist/index.js';

    const map = await createMap({
      apiKey: "fsq3CYDP77ybwoo1KtkJigGRj6g0uYyhWVw25jM+zN6ovbI=",
      container: document.getElementById('map-container'),
      // this loads a published map
      // (original url: https://studio.foursquare.com/public/806b95d0-36bb-402c-b16c-24e54af4a761)
      initialState: {
        publishedMapId: 'ffc494e8-2565-4dfc-be79-bd4d105ee578'
      }
    });
  </script>
</head>
<body>
<div id="container">
  <!-- Map Container with Kepler map configured for San Ysidro (approx 50-mile radius) -->
  <div id="map-container">
    </div>

  <!-- Top Pill Container -->
  <div id="top-bar-container">
    <div id="top-bar">
      <button onclick="toggleLayer(this, 'Beach Closures')">Beach Closures</button>
      <button onclick="toggleLayer(this, 'H₂S Levels')">H₂S Levels</button>
      <button onclick="toggleLayer(this, 'Smell Complaints')">Smell Complaints</button>
      <button onclick="toggleLayer(this, 'Wastewater Spills')">Wastewater Spills</button>
      <button onclick="toggleLayer(this, 'Odor Complaints')">Odor Complaints</button>
    </div>
  </div>

  <!-- Sidebar / Drawer -->
  <div id="sidebar">
    <!-- Mobile Drawer Handle -->
    <div id="drawer-handle" onclick="toggleSidebar()"></div>
    <!-- Desktop Close Button -->
    <button id="close-sidebar" onclick="toggleSidebar()">✕</button>

    <!-- Card: What We Know (No time widget here) -->
    <div class="card" onclick="selectCard('What We Know')">
      <div class="card-header">
        <span class="card-title">What We Know</span>
        <button class="expand-btn" onclick="event.stopPropagation(); toggleExpand('know-info')">⌄</button>
      </div>
      <p>Studies indicate increased flow and improved clarity in the Tijuana River, though contaminants persist.</p>
      <div id="know-info" class="expandable">
        <p>Data shows that despite improved clarity, harmful chemicals and bacteria remain. Continued testing is advised.</p>
        <a href="#">Learn more</a>
      </div>
    </div>

    <!-- Card: Air Quality (with time widget inside expandable section) -->
    <div class="card" onclick="selectCard('Air Quality')">
      <div class="card-header">
        <span class="card-title">Air Quality</span>
        <button class="expand-btn" onclick="event.stopPropagation(); toggleExpand('aq-info')">⌄</button>
      </div>
      <div class="card-data">
        <span class="indicator moderate"></span>
        <span>AQI: 42</span>
        <span class="trend-up">▲ +3%</span>
      </div>
      <div id="aq-info" class="expandable">
        <p>Urban emissions contribute to moderate air quality. Pollutant levels are rising.</p>
        <a href="#">Check full AQI report</a>
        <div class="time-widget">
          <span class="time-title">Time Range:</span>
          <input type="range" min="2000" max="2025" value="2010" class="time-slider">
          <button class="time-play" onclick="playTime('Air Quality', this.previousElementSibling)">Play</button>
        </div>
      </div>
    </div>

    <!-- Card: Hydrogen Sulfide Levels (with time widget inside expandable section) -->
    <div class="card" onclick="selectCard('H₂S Levels')">
      <div class="card-header">
        <span class="card-title">Hydrogen Sulfide Levels</span>
        <button class="expand-btn" onclick="event.stopPropagation(); toggleExpand('hs-info')">⌄</button>
      </div>
      <div class="card-data">
        <span class="indicator high"></span>
        <span>1.2 ppm (Imperial Beach)</span>
        <span class="trend-down">▼ -0.2 ppm</span>
      </div>
      <div id="hs-info" class="expandable">
        <p>Elevated H₂S detected near the border with variable readings among stations.</p>
        <a href="#">See real-time monitoring</a>
        <div class="time-widget">
          <span class="time-title">Time Range:</span>
          <input type="range" min="2000" max="2025" value="2010" class="time-slider">
          <button class="time-play" onclick="playTime('H₂S Levels', this.previousElementSibling)">Play</button>
        </div>
      </div>
    </div>

    <!-- Card: Beach Closures (with time widget inside expandable section) -->
    <div class="card" onclick="selectCard('Beach Closures')">
      <div class="card-header">
        <span class="card-title">Beach Closures</span>
        <button class="expand-btn" onclick="event.stopPropagation(); toggleExpand('beach-info')">⌄</button>
      </div>
      <div class="card-data">
        <span class="indicator high"></span>
        <span>2 Beaches Closed</span>
        <span class="trend-up">▲ +1</span>
      </div>
      <div id="beach-info" class="expandable">
        <p>Bacteria levels along parts of the Tijuana River have led to closures.</p>
        <a href="#">View closure map</a>
        <div class="time-widget">
          <span class="time-title">Time Range:</span>
          <input type="range" min="2000" max="2025" value="2010" class="time-slider">
          <button class="time-play" onclick="playTime('Beach Closures', this.previousElementSibling)">Play</button>
        </div>
      </div>
    </div>

    <!-- Card: Public Odor Complaints (with time widget inside expandable section) -->
    <div class="card" onclick="selectCard('Odor Complaints')">
      <div class="card-header">
        <span class="card-title">Public Odor Complaints</span>
        <button class="expand-btn" onclick="event.stopPropagation(); toggleExpand('odor-info')">⌄</button>
      </div>
      <div class="card-data">
        <span class="indicator moderate"></span>
        <span>3 Complaints</span>
        <span class="trend-up">▲ +2</span>
      </div>
      <div id="odor-info" class="expandable">
        <p>
        <ul>
          <li><strong>Downtown:</strong> Strong rotten egg odor (Industrial)</li>
          <li><strong>Ocean Beach:</strong> Faint sewage odor (Sewage)</li>
          <li><strong>Little Italy:</strong> Chemical smell (Chemical)</li>
        </ul>
        </p>
        <a href="#">View odor complaints map</a>
        <div class="time-widget">
          <span class="time-title">Time Range:</span>
          <input type="range" min="2000" max="2025" value="2010" class="time-slider">
          <button class="time-play" onclick="playTime('Odor Complaints', this.previousElementSibling)">Play</button>
        </div>
      </div>
    </div>

    <!-- Text Card: What You Should Do -->
    <div class="text-card">
      <h3>What You Should Do</h3>
      <p>Avoid contact with affected waters, follow local advisories, and stay updated on safety guidelines.</p>
      <a href="#">Visit advisory page</a>
    </div>

    <!-- Text Card: What We Don't Know -->
    <div class="text-card">
      <h3>What We Don't Know</h3>
      <p>The long-term impact of contaminants and altered river flow remains uncertain.</p>
      <a href="#">Read current research</a>
    </div>

    <!-- Text Card: What You Can Do -->
    <div class="text-card">
      <h3>What You Can Do</h3>
      <p>Report unusual conditions to local authorities and share your observations with your community.</p>
      <a href="#">Submit a report</a>
    </div>
  </div>

  <!-- Sidebar Toggle Button (for Desktop) -->
  <button id="open-sidebar-btn" onclick="toggleSidebar()">☰</button>
</div>

<script>
  // Toggle Sidebar Function
  function toggleSidebar() {
    var sidebar = document.getElementById("sidebar");
    var openBtn = document.getElementById("open-sidebar-btn");
    if (window.innerWidth > 768) {
      if (window.getComputedStyle(sidebar).display !== "none") {
        sidebar.style.display = "none";
        openBtn.style.display = "block";
      } else {
        sidebar.style.display = "block";
        openBtn.style.display = "none";
      }
    } else {
      sidebar.classList.toggle("open");
    }
  }

  // Toggle Expand Function for Cards
  function toggleExpand(id) {
    var section = document.getElementById(id);
    if (window.getComputedStyle(section).display === "none") {
      section.style.display = "block";
    } else {
      section.style.display = "none";
    }
  }

  // Toggle Layer Function for Top Pills
  function toggleLayer(button, layer) {
    button.classList.toggle("active");
    console.log("Toggled layer:", layer);
  }

  // When a card is clicked, select the corresponding pill
  function selectCard(layer) {
    var buttons = document.querySelectorAll("#top-bar button");
    buttons.forEach(function(btn) {
      btn.classList.remove("active");
      if (btn.textContent.trim().toLowerCase() === layer.toLowerCase()) {
        btn.classList.add("active");
      }
    });
    console.log("Selected card for layer:", layer);
  }

  // Dummy play function for time widget
  function playTime(layer, sliderElem) {
    console.log("Playing time for " + layer + ", current value: " + sliderElem.value);
    // Implement map updates based on time here.
  }

  // Initialization on page load
  document.addEventListener("DOMContentLoaded", function() {
    if (window.innerWidth > 768) {
      document.getElementById("sidebar").style.display = "block";
      document.getElementById("open-sidebar-btn").style.display = "none";
      document.getElementById("drawer-handle").style.display = "none";
    } else {
      document.getElementById("sidebar").classList.remove("open");
      document.getElementById("drawer-handle").style.display = "block";
    }
  });

  window.addEventListener("resize", function() {
    if (window.innerWidth > 768) {
      document.getElementById("sidebar").style.display = "block";
      document.getElementById("sidebar").classList.remove("open");
      document.getElementById("open-sidebar-btn").style.display = "none";
      document.getElementById("drawer-handle").style.display = "none";
    } else {
      document.getElementById("sidebar").style.display = "block";
      document.getElementById("sidebar").classList.remove("hidden");
      document.getElementById("open-sidebar-btn").style.display = "none";
      document.getElementById("drawer-handle").style.display = "block";
    }
  });
</script>
</body>
</html>
