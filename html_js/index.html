<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Environmental Dashboard</title>
  <style>
    /* Global Reset */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      width: 100vw;
      height: 100vh;
      font-family: 'Roboto', sans-serif;
      background: #f8f8f8;
      overflow: hidden;
    }

    /* hide wrapper */
    .reportview-container {
      margin-top: -2em;
    }

    #MainMenu {
      visibility: hidden;
    }

    .stDeployButton {
      display: none;
    }

    footer {
      visibility: hidden;
    }

    #stDecoration {
      display: none;
    }

    /* Main Container */
    #container {
      position: relative;
      width: 100vw;
      height: 100vh;
    }

    /* Map Container */
    #map-container {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 10;
    }

    #map-container iframe {
      width: 100%;
      height: 100%;
      border: none;
    }

    #hidepanel {
      width: 40px;
      height: 100%;
      z-index: 11;
      background-color: grey;
      position: absolute;
    }

    /* Top Pill Container */
    #top-bar-container {
      position: absolute;
      z-index: 120;
    }

    /* Desktop: pills placed to the right of sidebar */
    @media (min-width: 769px) {
      #top-bar-container {
        top: 15px;
        left: calc(360px + 20px);
        right: 20px;
        text-align: center;
      }

      #top-bar {
        display: inline-flex;
        gap: 6px;
        background: rgba(255, 255, 255, 0.95);
        border-radius: 50px;
        padding: 6px 10px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        overflow-x: auto;
        white-space: nowrap;
        justify-content: center;
      }
    }

    /* Mobile: pills centered */
    @media (max-width: 768px) {
      #top-bar-container {
        top: 15px;
        left: 50%;
        transform: translateX(-50%);
        width: 90%;
        text-align: center;
      }

      #top-bar {
        display: flex;
        justify-content: space-around;
        gap: 6px;
        background: rgba(255, 255, 255, 0.95);
        border-radius: 50px;
        padding: 6px 10px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        overflow-x: auto;
        white-space: nowrap;
      }
    }

    #top-bar button {
      background: none;
      border: none;
      padding: 4px 8px;
      cursor: pointer;
      font-size: 14px;
      border-radius: 20px;
      flex: 0 0 auto;
      transition: background 0.2s;
    }

    #top-bar button:hover {
      background: rgba(0, 0, 0, 0.1);
    }

    #top-bar button.active {
      background: #007bff;
      color: white;
    }

    /* Desktop Sidebar */
    @media (min-width: 769px) {
      #sidebar {
        position: absolute;
        top: 20px;
        left: 20px;
        width: 360px;
        height: calc(100% - 40px);
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        z-index: 110;
        overflow-y: auto;
        padding: 15px;
      }

      #sidebar.hidden {
        display: none;
      }

      #open-sidebar-btn {
        display: none;
      }
    }

    /* Mobile Drawer */
    @media (max-width: 768px) {
      #sidebar {
        position: fixed;
        bottom: 0;
        left: 50%;
        transform: translateX(-50%) translateY(70%);
        width: 100%;
        height: 60vh;
        border-radius: 20px 20px 0 0;
        background: #fff;
        box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.2);
        z-index: 110;
        overflow-y: auto;
        padding: 15px;
        transition: transform 0.3s ease-in-out;
      }

      #sidebar.open {
        transform: translateX(-50%) translateY(0);
      }

      /* Drawer Handle */
      #drawer-handle {
        width: 50px;
        height: 5px;
        background: #ccc;
        border-radius: 2.5px;
        margin: 8px auto;
        cursor: pointer;
        display: block;
      }

      #open-sidebar-btn {
        display: none !important;
      }
    }

    /* Sidebar Toggle Button (Desktop) */
    #open-sidebar-btn {
      position: absolute;
      top: 20px;
      left: 20px;
      z-index: 130;
      background: #fff;
      border: none;
      border-radius: 50%;
      padding: 10px;
      font-size: 18px;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    }

    /* Card Styles */
    .card {
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 12px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      width: 100%;
      cursor: pointer;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .card-title {
      font-size: 16px;
      font-weight: bold;
      color: #333;
    }

    .expand-btn {
      cursor: pointer;
      font-size: 18px;
      color: #007bff;
      border: none;
      background: none;
    }

    .expandable {
      display: none;
      margin-top: 10px;
    }

    .expandable a {
      color: #007bff;
      text-decoration: none;
    }

    .expandable a:hover {
      text-decoration: underline;
    }

    .card-data {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-top: 8px;
    }

    .indicator {
      width: 14px;
      height: 14px;
      border-radius: 50%;
      margin-right: 8px;
      display: inline-block;
    }

    .indeterminate {
      background: white;
    }

    .low {
      background: #4CAF50;
    }

    .moderate {
      background: #FFC107;
    }

    .high {
      background: #FF5722;
    }

    /* APCD H2s */
    .white {
      background: white;
    }

    .green {
      background: #00E400;
    }

    .yellow {
      background: #ffff00;
    }

    .orange {
      background: #FF7E00;
    }

    .purple {
      background: #CC58DB;
    }

    .trend-up {
      color: #4CAF50;
      font-size: 16px;
      font-weight: bold;
    }

    .trend-down {
      color: #FF5722;
      font-size: 16px;
      font-weight: bold;
    }

    /* Time Widget Styles (inside expandable area) */
    .time-widget {
      margin-top: 8px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .time-widget .time-title {
      font-size: 14px;
      color: #333;
    }

    .time-widget input[type=range] {
      flex: 1;
    }

    .time-widget button {
      background: #007bff;
      color: #fff;
      border: none;
      border-radius: 4px;
      padding: 2px 6px;
      font-size: 12px;
      cursor: pointer;
    }

    /* Text Card Styles */
    .text-card {
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 12px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      width: 100%;
    }

    .text-card h3 {
      font-size: 16px;
      font-weight: bold;
      color: #333;
      margin-bottom: 6px;
    }

    .text-card p {
      font-size: 14px;
      color: #555;
      line-height: 1.5;
    }

    /* Bottom Pill Container */
    #bottom-bar-container {
      position: absolute;
      z-index: 120;
    }

    /* Desktop: pills placed to the right of sidebar */
    @media (min-width: 769px) {
      #bottom-bar-container {
        bottom: 15px;
        left: calc(360px + 20px);
        right: 20px;
        text-align: center;
      }

      #bottom-bar {
        display: inline-flex;

        gap: 6px;
        background: rgba(255, 255, 255, 0.95);
        border-radius: 50px;
        padding: 6px 10px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        overflow-x: auto;
        white-space: nowrap;
        justify-content: center;
      }
    }

    /* Mobile: pills centered */
    @media (max-width: 768px) {
      #bottom-bar-container {
        bottom: 15px;
        left: 50%;
        transform: translateX(-50%);
        width: 90%;
        text-align: center;
      }

      #bottom-bar {
        display: flex;
        justify-content: space-around;
        gap: 6px;
        background: rgba(255, 255, 255, 0.95);
        border-radius: 50px;
        padding: 6px 10px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        overflow-x: auto;
        white-space: nowrap;
      }
    }

    #bottom-bar a {
      background: none;
      border: none;
      padding: 4px 8px;
      cursor: pointer;
      font-size: 14px;
      border-radius: 20px;
      flex: 0 0 auto;
      transition: background 0.2s;
    }

    #top-bar a:hover {
      background: rgba(0, 0, 0, 0.1);
    }

    #top-bar a.active {
      background: #007bff;
      color: white;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script>

  <!--  <script type="module" src="js/fsmap.js"></script>-->
  <script type="module">
    const fs = "fsq3CYDP77ybwoo1KtkJigGRj6g0uYyhWVw25jM+zN6ovbI="
    const mapuid = '6ce3b305-7e09-44b3-8725-34dcf59bb56d'
    //   import {createMap} from 'https://corsproxy.io/?key=3d648870&url=https://cdn.jsdelivr.net/npm/@foursquare/map-sdk@latest/dist/index.js';
    import {createMap} from 'https://cdn.jsdelivr.net/npm/@foursquare/map-sdk@latest/dist/index.js';

    const map = await createMap({
      apiKey: fs,
      container: document.getElementById('map-container'),
      // this loads a published map
      // (original url: https://studio.foursquare.com/public/806b95d0-36bb-402c-b16c-24e54af4a761)
      initialState: {
        publishedMapId: mapuid
      }

    });
    // cannot override style sheet. #shadow-root is closed.
    // var sheet = new CSSStyleSheet
    // sheet.replaceSync( `.unfolded-root + div + div  {visibility: collapse;}`)
    // map.shadowRoot.adoptedStyleSheets.push(sheet) // You want to add to stylesheets list
    globalThis.map = map

  </script>


  <script>
    //     <button onclick="toggleLayer(this, 'Beach Closures')">Beach Closures</button>

    // Toggle Sidebar Function
    const layerInfo = [
      {label: 'H₂S Levels', id: 'g0nrfjd'}, // health layer for now
      {label: 'Smell Complaints', id: '49rpvvq'}, // odor
      {label: 'Wastewater Spills', id: 'hg4pxs'}, // water
      {label: 'Beach Closures', id: 'dpoomlg'}, // observations
      {label: 'River Basin', id: '6n6ymt9'},

    ]

    function toggleSidebar() {
      var sidebar = document.getElementById("sidebar");
      var openBtn = document.getElementById("open-sidebar-btn");
      if (window.innerWidth > 768) {
        if (window.getComputedStyle(sidebar).display !== "none") {
          sidebar.style.display = "none";
          openBtn.style.display = "block";
        } else {
          sidebar.style.display = "block";
          openBtn.style.display = "none";
        }
      } else {
        sidebar.classList.toggle("open");
      }
    }

    // Toggle Expand Function for Cards
    function toggleExpand(id) {
      var section = document.getElementById(id);
      if (window.getComputedStyle(section).display === "none") {
        section.style.display = "block";
      } else {
        section.style.display = "none";
      }
    }

    // Toggle Layer Function for Top Pills
    function toggleLayer(button, layer) {
      if (undefined !== map) {


        button.classList.toggle("active");
        console.log("Toggled layer:", layer);
        const layerid = layerInfo.find((l) => l.label == layer)
        console.log("Toggled layer:" + layer + " layerid:", layerid);
        const groups = map.getLayerGroups();
        console.log("Toggled layer: groups", groups);
        let targetLayer = groups.find((g) => g.id == layerid.id)
        console.log("Target layer:", targetLayer);
        if (targetLayer.isVisible) {
          targetLayer.isVisible = false;

        } else {
          targetLayer.isVisible = true;

        }
        map.updateLayerGroup(targetLayer.id, targetLayer)
      } else {
        console.log("toggleLayer: no map object: ", layer);
      }

    }

    // When a card is clicked, select the corresponding pill
    function selectCard(layer) {
      var buttons = document.querySelectorAll("#top-bar button");
      buttons.forEach(function (btn) {
        btn.classList.remove("active");
        if (btn.textContent.trim().toLowerCase() === layer.toLowerCase()) {
          btn.classList.add("active");
        }
      });
      console.log("Selected card for layer:", layer);
    }

    // Dummy play function for time widget
    function playTime(layer, sliderElem) {
      console.log("Playing time for " + layer + ", current value: " + sliderElem.value);
      // Implement fsmap updates based on time here.
    }

    // Initialization on page load
    document.addEventListener("DOMContentLoaded", function () {
      if (window.innerWidth > 768) {
        document.getElementById("sidebar").style.display = "block";
        document.getElementById("open-sidebar-btn").style.display = "none";
        document.getElementById("drawer-handle").style.display = "none";
      } else {
        document.getElementById("sidebar").classList.remove("open");
        document.getElementById("drawer-handle").style.display = "block";
      }
    });

    window.addEventListener("resize", function () {
      if (window.innerWidth > 768) {
        document.getElementById("sidebar").style.display = "block";
        document.getElementById("sidebar").classList.remove("open");
        document.getElementById("open-sidebar-btn").style.display = "none";
        document.getElementById("drawer-handle").style.display = "none";
      } else {
        document.getElementById("sidebar").style.display = "block";
        document.getElementById("sidebar").classList.remove("hidden");
        document.getElementById("open-sidebar-btn").style.display = "none";
        document.getElementById("drawer-handle").style.display = "block";
      }
    });
  </script>

</head>
<body>
<div id="container">
  <!-- Map Container with Kepler fsmap configured for San Ysidro (approx 50-mile radius) -->
  <div id="map-container">
  </div>
  <div id="hidepanel">
  </div>
  <!-- Top Pill Container -->
  <div id="top-bar-container">
    <div id="top-bar">
      <button class="active" onclick="toggleLayer(this, 'Beach Closures')">Beach Closures</button>
      <button class="active" onclick="toggleLayer(this, 'H₂S Levels')">H₂S Levels</button>
      <button class="active" onclick="toggleLayer(this, 'Smell Complaints')">Smell Complaints</button>
      <button class="active" onclick="toggleLayer(this, 'Wastewater Spills')">Wastewater Spills</button>
      <button onclick="toggleLayer(this, 'River Basin')">River Basin</button>
    </div>
  </div>

  <!-- Sidebar / Drawer -->
  <div id="sidebar">
    <!-- Mobile Drawer Handle -->
    <div id="drawer-handle" onclick="toggleSidebar()"></div>
    <!-- Desktop Close Button -->
    <button id="close-sidebar" onclick="toggleSidebar()">✕</button>
    <div class="card-header">
      <img src="img/logoCOSD.png" height="24" width="24">
      <a href="https://www.sandiegocounty.gov/">County of San Diego</a>
    </div>
    <!-- Card: What We Know (No time widget here) -->
    <div class="card" onclick="selectCard('What We Know')">
      <div class="card-header">
        <span class="card-title">What We Know</span>
        <button class="expand-btn" onclick="event.stopPropagation(); toggleExpand('know-info')">⌄</button>
      </div>
      <p>Studies indicate increased flow and improved clarity in the Tijuana River, though contaminants persist.</p>
      <div id="know-info" class="expandable">
        <p>Data shows that despite improved clarity, harmful chemicals and bacteria remain. Continued testing is
          advised.</p>
        <a href="#">Learn more</a>
      </div>
    </div>

    <!-- Card: Air Quality (with time widget inside expandable section) -->
    <!--    <div class="card" onclick="selectCard('Air Quality')">-->
    <!--      <div class="card-header">-->
    <!--        <span class="card-title">Air Quality</span>-->
    <!--        <button class="expand-btn" onclick="event.stopPropagation(); toggleExpand('aq-info')">⌄</button>-->
    <!--      </div>-->
    <!--      <div class="card-data">-->
    <!--        <span class="indicator moderate"></span>-->
    <!--        <span>AQI: 42</span>-->
    <!--        <span class="trend-up">▲ +3%</span>-->
    <!--      </div>-->
    <!--      <div id="aq-info" class="expandable">-->
    <!--        <p>Urban emissions contribute to moderate air quality. Pollutant levels are rising.</p>-->
    <!--        <a href="#">Check full AQI report</a>-->
    <!--        <div class="time-widget">-->
    <!--          <span class="time-title">Time Range:</span>-->
    <!--          <input type="range" min="2000" max="2025" value="2010" class="time-slider">-->
    <!--          <button class="time-play" onclick="playTime('Air Quality', this.previousElementSibling)">Play</button>-->
    <!--        </div>-->
    <!--      </div>-->
    <!--    </div>-->

    <!-- Card: Hydrogen Sulfide Levels (with time widget inside expandable section) -->
    <div class="card" onclick="selectCard('H₂S Levels')">
      <div class="card-header">
        <span class="card-title">Hydrogen Sulfide Levels</span>
        <button class="expand-btn" onclick="event.stopPropagation(); toggleExpand('hs-info')">⌄</button>
      </div>
      <div id="h2s_summary">
        <div class="card-data">
          <span class="indicator moderate"></span>
          <span>7.4 ppm (Imperial Beach)</span>
          <span class="trend-down">▼ -0.2 ppm</span>
        </div>
        <div class="card-data">
          <span class="indicator moderate"></span>
          <span>12.5 ppm (Nestor)</span>
          <span class="trend-down">▼ -0.2 ppm</span>
        </div>
        <div class="card-data">
          <span class="indicator low"></span>
          <span>NA (San Ysidro)</span>
          <span class="trend-down">▼ -0.2 ppm</span>
        </div>
      </div>

      <div id="hs-info" class="expandable">
        <p>Elevated H₂S detected near the border with variable readings among stations.</p>
        <a
          href="https://app.powerbigov.us/view?r=eyJrIjoiOGMwYzM2ZGYtZGU4Ny00ZGI5LWE2NWMtMmZlOGEzZTYzMDc3IiwidCI6IjQ1NjNhZjEzLWMwMjktNDFiMy1iNzRjLTk2NWU4ZWVjOGY5NiJ9">See
          real-time monitoring</a>
        <div class="time-widget">
          <span class="time-title">Time Range:</span>
          <input type="range" min="2000" max="2025" value="2010" class="time-slider">
          <button class="time-play" onclick="playTime('H₂S Levels', this.previousElementSibling)">Play</button>
        </div>
      </div>
    </div>

    <!-- Card: Beach Closures (with time widget inside expandable section) -->
    <div class="card" onclick="selectCard('Beach Closures')">
      <div class="card-header">
        <span class="card-title">Beach Closures</span>
        <button class="expand-btn" onclick="event.stopPropagation(); toggleExpand('beach-info')">⌄</button>
      </div>
      <div class="card-data">
        <span class="indicator high"></span>
        <span>9 Beaches Closed</span>
        <span class="trend-up">▲ +1</span>
      </div>
      <div id="beach-info" class="expandable">
        <p>Bacteria levels along parts of the Tijuana River have led to closures.</p>
        <a href="#">View closure fsmap</a>
        <div class="time-widget">
          <span class="time-title">Time Range:</span>
          <input type="range" min="2000" max="2025" value="2010" class="time-slider">
          <button class="time-play" onclick="playTime('Beach Closures', this.previousElementSibling)">Play</button>
        </div>
      </div>
    </div>

    <!-- Card: Public Odor Complaints (with time widget inside expandable section) -->
    <div class="card" onclick="selectCard('Odor Complaints')">
      <div class="card-header">
        <span class="card-title">Public Odor Complaints</span>
        <button class="expand-btn" onclick="event.stopPropagation(); toggleExpand('odor-info')">⌄</button>
      </div>
      <div class="card-data">
        <span class="indicator moderate"></span>
        <span>14 Complaints</span>
        <span class="trend-up">▲ +2</span>
      </div>
      <div id="odor-info" class="expandable">

        <ul>
          <li><strong>Downtown:</strong> Strong rotten egg odor (Industrial)</li>
          <li><strong>Ocean Beach:</strong> Faint sewage odor (Sewage)</li>
          <li><strong>Little Italy:</strong> Chemical smell (Chemical)</li>
        </ul>

        <a href="#">View odor complaints fsmap</a>
        <div class="time-widget">
          <span class="time-title">Time Range:</span>
          <input type="range" min="2000" max="2025" value="2010" class="time-slider">
          <button class="time-play" onclick="playTime('Odor Complaints', this.previousElementSibling)">Play</button>
        </div>
      </div>
    </div>

    <!-- Text Card: What You Should Do -->
    <div class="text-card">
      <h3>What You Should Do</h3>
      <p>Avoid contact with affected waters, follow local advisories, and stay updated on safety guidelines.</p>
      <a href="https://www.sandiegocounty.gov/content/sdc/hhsa/programs/phs/community_epidemiology/south-region-health-concerns.html">Visit South Region Health Concerns webpage</a>
    </div>

    <!-- Text Card: What We Don't Know -->
    <div class="text-card">
      <h3>What We Don't Know</h3>
      <p>The long-term impact of contaminants and altered river flow remains uncertain.</p>
      <a href="#">Read current research</a>
    </div>

    <!-- Text Card: What You Can Do -->
    <div class="text-card" class="expandable">
      <div class="card-header">
        <span class="card-title">What You Can Do</span>
        <button class="expand-btn" onclick="event.stopPropagation(); toggleExpand('you-can-do')">⌄</button>
      </div>
      <div>
        <p>Report unusual conditions to local authorities and share your observations with your community.</p>
        <a href="#">Submit a report</a>
      </div>
      <div id="you-can-do" class="card-data" style="display: none">

        <div class="text-card">
          <h3>About Water Quality Issues</h3>
          <p>Check online to find out which beaches are closed, have health advisories, or are being monitored for water
            quality. This is especially important after heavy rain
            Stay away from areas with visible sewage spills
            Stay out of floodwater
            Do not swim, go into, or swallow contaminated water sources
            .</p>
        </div>
        <div class="text-card">
          <h3>About Air Quality</h3>
          <p>Reduce your exposure to poor quality air or strong odors by limiting outdoor activity, keeping windows and
            doors closed, and airing out your home or business when odors are not present
            If available, use air conditioning or portable indoor air purifiers. Look into whether filters need to be
            replaced
            Use certified HEPA filters with activated charcoal
            If possible, run your air conditioner at your business for 1-2 hours before opening”
          </p>
        </div>

      </div>
    </div>
    <!-- Text Card: What We’re Doing -->
    <div class="text-card">
      <div class="card-header">
        <span class="card-title">What We’re Doing</span>

      </div>

        <p>County of San Diego officials are working with partners and other agencies to assess concerns and impacts from
          sewage and pollution in the Tijuana River Valley and surrounding communities.
          There are multi-agency efforts to address air and water quality issues in the Tijuana River Valley that are
          impacting San Diego area communities.
        </p>
        <p>
          More information about what actions the County is taking to ensure the health and quality of life for South
          Region residents can be found here: <a
          href="https://www.sandiegocounty.gov/content/sdc/hhsa/programs/phs/community_epidemiology/south-region-health-concerns/County-Role.html">What
          the County is Doing</a>
        </p>



    </div>
    <div class="text-card">
      <div class="card-header">
        <span class="card-title">For More Information</span>

      </div>
      <div class="text-card">
        For details on the County’s response to the sewage crisis and how to protect your health, visit the      <a href="https://www.sandiegocounty.gov/content/sdc/hhsa/programs/phs/community_epidemiology/south-region-health-concerns.html">Visit South Region Health Concerns webpage</a>

      </div>

    <div class="text-card">
      <h4>Contact & Feedback </h4>
      <div>For questions or feedback,</div> please <a href="mailto:phs.southregionhealth.hhsa@sdcounty.ca.gov"
      >email the Epidemiology Unit</a>
    </div>


      <div class="text-card">
        <h4> For more details about specific datasets, visit:</h4>
      <ul>
      <li><a href="https://sdbeachinfo.com/">San Diego Beach & Bay Water Quality Program</a></li>
        <li> <a href="https://www.sdapcd.org/">San Diego Air Pollution Control District</a></li>
        <li> <a href="https://www.ibwc.gov/">International Boundary and Water Commission</a></li>
        <li><a href="https://www.sandiegocounty.gov/content/sdc/hhsa/programs/phs/community_epidemiology/south-region-health-concerns/Local-Data.html">South Region Health Concerns Public Health Data</a>
        </li>
      </ul>
    </div>



    </div>
  </div>

</div>
<!-- Sidebar Toggle Button (for Desktop) -->
<button id="open-sidebar-btn" onclick="toggleSidebar()">☰</button>
</div>
<!--<div id="bottom-bar-container">-->
<!--  <div id="bottom-bar">-->
<!--    <img src="img/logoCOSD.png" height="24" width="24">-->
<!--    <a href="https://www.sandiegocounty.gov/">County of San Diego</a>-->
<!--    <a href="https://www.sandiegocounty.gov/deh/">Department of Environmental Health and Quality</a>-->
<!--  </div>-->
<!--</div>-->
<!--<script>-->
<!--  // Toggle Sidebar Function-->
<!--  function toggleSidebar() {-->
<!--    var sidebar = document.getElementById("sidebar");-->
<!--    var openBtn = document.getElementById("open-sidebar-btn");-->
<!--    if (window.innerWidth > 768) {-->
<!--      if (window.getComputedStyle(sidebar).display !== "none") {-->
<!--        sidebar.style.display = "none";-->
<!--        openBtn.style.display = "block";-->
<!--      } else {-->
<!--        sidebar.style.display = "block";-->
<!--        openBtn.style.display = "none";-->
<!--      }-->
<!--    } else {-->
<!--      sidebar.classList.toggle("open");-->
<!--    }-->
<!--  }-->

<!--  // Toggle Expand Function for Cards-->
<!--  function toggleExpand(id) {-->
<!--    var section = document.getElementById(id);-->
<!--    if (window.getComputedStyle(section).display === "none") {-->
<!--      section.style.display = "block";-->
<!--    } else {-->
<!--      section.style.display = "none";-->
<!--    }-->
<!--  }-->


<!--  // When a card is clicked, select the corresponding pill-->
<!--  function selectCard(layer) {-->
<!--    var buttons = document.querySelectorAll("#top-bar button");-->
<!--    buttons.forEach(function(btn) {-->
<!--      btn.classList.remove("active");-->
<!--      if (btn.textContent.trim().toLowerCase() === layer.toLowerCase()) {-->
<!--        btn.classList.add("active");-->
<!--      }-->
<!--    });-->
<!--    console.log("Selected card for layer:", layer);-->
<!--  }-->

<!--  // Dummy play function for time widget-->
<!--  function playTime(layer, sliderElem) {-->
<!--    console.log("Playing time for " + layer + ", current value: " + sliderElem.value);-->
<!--    // Implement fsmap updates based on time here.-->
<!--  }-->

<!--  // Initialization on page load-->
<!--  document.addEventListener("DOMContentLoaded", function() {-->
<!--    if (window.innerWidth > 768) {-->
<!--      document.getElementById("sidebar").style.display = "block";-->
<!--      document.getElementById("open-sidebar-btn").style.display = "none";-->
<!--      document.getElementById("drawer-handle").style.display = "none";-->
<!--    } else {-->
<!--      document.getElementById("sidebar").classList.remove("open");-->
<!--      document.getElementById("drawer-handle").style.display = "block";-->
<!--    }-->
<!--  });-->

<!--  window.addEventListener("resize", function() {-->
<!--    if (window.innerWidth > 768) {-->
<!--      document.getElementById("sidebar").style.display = "block";-->
<!--      document.getElementById("sidebar").classList.remove("open");-->
<!--      document.getElementById("open-sidebar-btn").style.display = "none";-->
<!--      document.getElementById("drawer-handle").style.display = "none";-->
<!--    } else {-->
<!--      document.getElementById("sidebar").style.display = "block";-->
<!--      document.getElementById("sidebar").classList.remove("hidden");-->
<!--      document.getElementById("open-sidebar-btn").style.display = "none";-->
<!--      document.getElementById("drawer-handle").style.display = "block";-->
<!--    }-->
<!--  });-->
<!--</script>-->
<script>
  fetch('https://oss.resilientservice.mooo.com/resilentpublic/tijuana/sd_apcd_air/output/warnings/h2s.json')
    .then(response => {
      if (!response.ok) {
        throw new Error('Network response was not ok: ' + response.statusText);
      }
      return response.json();
    })
    .then(jsonData => {
      const jsonDiv = document.getElementById('h2s_summary');
      const h2shead = document.createElement("div")
      h2shead.innerText = "Recent Events"
      jsonDiv.innerText = ''
      jsonDiv.appendChild(h2shead)

      // Convert JSON data to a formatted string for display
      jsonData.forEach(
        h2s => {
          const d = document.createElement("div");
          d.className = "card-data"
          const ind = document.createElement("span");
          switch (h2s['level']) {
            case 'orange':
              ind.className = "indicator orange"
              break;
            case 'yellow':
              ind.className = "indicator yellow"
              break;
            case 'green':
              ind.className = "indicator green"
              break;
            case 'purple':
              ind.className = "indicator purple"
              break;
            default:
              ind.className = "indicator white"
              break;
          }

          const result = document.createElement("span");
          result.innerText = h2s['Result']
          const date = document.createElement("span");
          let dt = new Date(h2s['Date with time'])
          //const day = dt.getDay()
          const tm = dt.toLocaleTimeString("en-US")
          date.innerText = tm
          const name = document.createElement("span");
          name.innerText = h2s['Site Name']
          d.appendChild(ind)
          d.appendChild(result)
          d.appendChild(date)
          d.appendChild(name)
          jsonDiv.appendChild(d)
        }
      )
    })
    .catch(error => {
      console.error('Error fetching the JSON:', error);
    });
  fetch('https://oss.resilientservice.mooo.com/resilentpublic/tijuana/sd_complaints/output/complaints_by_date.json')
    .then(response => {
      if (!response.ok) {
        throw new Error('Network response was not ok: ' + response.statusText);
      }
      return response.json();
    })
    .then(jsonData => {
      const jsonDiv = document.getElementById('odor-info');
      const h2shead = document.createElement("ul")
      h2shead.innerText = "Recent Events"
      jsonDiv.innerText = ''
      jsonDiv.appendChild(h2shead)

      // Convert JSON data to a formatted string for display
      jsonData.forEach(
        h2s => {
          const d = document.createElement("li");
          d.className = "card-data"
          const ind = document.createElement("span");
          switch (h2s['level']) {
            case 'orange':
              ind.className = "indicator orange"
              break;
            case 'yellow':
              ind.className = "indicator yellow"
              break;
            case 'green':
              ind.className = "indicator green"
              break;
            case 'purple':
              ind.className = "indicator purple"
              break;
            default:
              ind.className = "indicator white"
              break;
          }

          const result = document.createElement("span");
          result.innerText = h2s['Result']
          const date = document.createElement("span");
          let dt = new Date(h2s['Date with time'])
          //const day = dt.getDay()
          const tm = dt.toLocaleTimeString("en-US")
          date.innerText = tm
          const name = document.createElement("span");
          name.innerText = h2s['Site Name']
          d.appendChild(ind)
          d.appendChild(result)
          d.appendChild(date)
          d.appendChild(name)
          jsonDiv.appendChild(d)
        }
      )
    })
    .catch(error => {
      console.error('Error fetching the JSON:', error);
    });
  fetch('https://oss.resilientservice.mooo.com/resilentpublic/tijuana/beachwatch/output/beachwatch_closure_simple.json')
    .then(response => {
      if (!response.ok) {
        throw new Error('Network response was not ok: ' + response.statusText);
      }
      return response.json();
    })
    .then(jsonData => {
      const jsonDiv = document.getElementById('odor-info');
      const h2shead = document.createElement("ul")
      h2shead.innerText = "Recent Events"
      jsonDiv.innerText = ''
      jsonDiv.appendChild(h2shead)

      // Convert JSON data to a formatted string for display
      jsonData.forEach(
        h2s => {
          const d = document.createElement("li");
          d.className = "card-data"
          const ind = document.createElement("span");
          switch (h2s['level']) {
            case 'orange':
              ind.className = "indicator orange"
              break;
            case 'yellow':
              ind.className = "indicator yellow"
              break;
            case 'green':
              ind.className = "indicator green"
              break;
            case 'purple':
              ind.className = "indicator purple"
              break;
            default:
              ind.className = "indicator white"
              break;
          }

          const result = document.createElement("span");
          result.innerText = h2s['Result']
          const date = document.createElement("span");
          let dt = new Date(h2s['Date with time'])
          //const day = dt.getDay()
          const tm = dt.toLocaleTimeString("en-US")
          date.innerText = tm
          const name = document.createElement("span");
          name.innerText = h2s['Site Name']
          d.appendChild(ind)
          d.appendChild(result)
          d.appendChild(date)
          d.appendChild(name)
          jsonDiv.appendChild(d)
        }
      )
    })
    .catch(error => {
      console.error('Error fetching the JSON:', error);
    });
</script>
</body>
</html>
